---
import metadata from "../data/metadata.json";

const { images, tags } = metadata;
---

{/* ── Search & Filters ─────────────────────────────── */}
<div class="mx-auto w-full max-w-6xl px-4 pt-6 pb-2 flex flex-col gap-3">
  {/* Search */}
  <div class="relative">
    <svg
      class="pointer-events-none absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-neutral-400"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <circle cx="11" cy="11" r="8" />
      <path d="m21 21-4.35-4.35" />
    </svg>
    <input
      id="search"
      type="search"
      placeholder="Search wallpapers…"
      autocomplete="off"
      class="w-full rounded-full border border-neutral-200 dark:border-neutral-800 bg-white dark:bg-neutral-950 py-2 pl-10 pr-4 text-sm outline-none focus:ring-2 focus:ring-black dark:focus:ring-white transition-shadow"
    />
  </div>

  {/* Tag pills */}
  {tags.length > 0 && (
    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
      <button
        data-tag="all"
        class="tag-btn shrink-0 rounded-full border border-neutral-300 dark:border-neutral-700 px-3 py-1 text-xs font-medium transition-colors bg-black text-white dark:bg-white dark:text-black"
      >
        All
      </button>
      {tags.map((tag: string) => (
        <button
          data-tag={tag}
          class="tag-btn shrink-0 rounded-full border border-neutral-300 dark:border-neutral-700 px-3 py-1 text-xs font-medium transition-colors hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black"
        >
          {tag}
        </button>
      ))}
    </div>
  )}
</div>

{/* ── Grid ──────────────────────────────────────────── */}
<div
  id="gallery"
  class="mx-auto w-full max-w-6xl columns-2 sm:columns-3 lg:columns-4 gap-1 px-1 py-2"
>
  {images.map((img: any, i: number) => (
    <a
      href={`/p/${img.id}`}
      class="gallery-item mb-1 block break-inside-avoid overflow-hidden"
      data-index={i}
      data-tags={img.tags.join(",")}
      data-title={img.title.toLowerCase()}
    >
      <div
        class="relative w-full"
        style={`aspect-ratio:${img.width}/${img.height}; background-color:${img.dominantColor}`}
      >
        <img
          src={img.srcSet[480]}
          srcset={`${img.srcSet[480]} 480w, ${img.srcSet[720]} 720w, ${img.srcSet[1080]} 1080w`}
          sizes="(max-width:640px) 50vw, (max-width:1024px) 33vw, 25vw"
          alt={img.title}
          loading="lazy"
          decoding="async"
          class="wall-img absolute inset-0 h-full w-full object-cover"
          style={`background-image:url(${img.placeholder});background-size:cover`}
        />
      </div>
    </a>
  ))}
</div>

{images.length === 0 && (
  <p class="py-24 text-center text-neutral-400">
    No wallpapers yet. Add images to <code class="text-xs">public/images/originals/</code> and run <code class="text-xs">npm run add-images</code>.
  </p>
)}

{/* ── Empty search state ─────────────────────────── */}
<p id="no-results" class="hidden py-24 text-center text-neutral-400">
  No wallpapers match your search.
</p>
