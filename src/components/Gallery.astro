---
import metadata from "../data/metadata.json";

const { images, tags } = metadata;
---

{/* ── Tag filters (only if tags exist) ────────────── */}
{tags.length > 0 && (
  <div class="mx-auto w-full max-w-6xl px-4 pt-6 pb-2">
    <div class="flex gap-2 overflow-x-auto no-scrollbar pb-1">
      <button
        data-tag="all"
        class="tag-btn shrink-0 rounded-full border border-neutral-300 dark:border-neutral-700 px-3 py-1 text-xs font-medium transition-colors bg-black text-white dark:bg-white dark:text-black"
      >
        All
      </button>
      {tags.map((tag: string) => (
        <button
          data-tag={tag}
          class="tag-btn shrink-0 rounded-full border border-neutral-300 dark:border-neutral-700 px-3 py-1 text-xs font-medium transition-colors hover:bg-black hover:text-white dark:hover:bg-white dark:hover:text-black"
        >
          {tag}
        </button>
      ))}
    </div>
  </div>
)}

{/* ── Grid ──────────────────────────────────────────── */}
<div
  id="gallery"
  class="mx-auto w-full max-w-6xl columns-2 sm:columns-3 lg:columns-4 gap-1 px-1 py-4"
>
  {images.map((img: any, i: number) => (
    <a
      href={`/p/${img.id}`}
      class="gallery-item mb-1 block break-inside-avoid overflow-hidden relative group"
      data-index={i}
      data-id={img.id}
      data-tags={img.tags.join(",")}
    >
      <div
        class="relative w-full"
        style={`aspect-ratio:${img.width}/${img.height}; background-color:${img.dominantColor}`}
      >
        <img
          src={img.srcSet[480]}
          srcset={`${img.srcSet[480]} 480w, ${img.srcSet[720]} 720w, ${img.srcSet[1080]} 1080w`}
          sizes="(max-width:640px) 50vw, (max-width:1024px) 33vw, 25vw"
          alt=""
          loading="lazy"
          decoding="async"
          class="wall-img absolute inset-0 h-full w-full object-cover"
          style={`background-image:url(${img.placeholder});background-size:cover`}
        />

        {/* Heart overlay */}
        <button
          class="like-btn absolute bottom-2 left-2 flex items-center gap-1 bg-black/40 backdrop-blur-sm rounded-full px-2 py-1 text-white transition-all hover:bg-black/60 z-10"
          data-id={img.id}
          aria-label="Like"
        >
          <svg class="like-icon h-3.5 w-3.5 transition-transform" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" fill="none">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />
          </svg>
          <span class="like-count text-[11px] font-medium leading-none">0</span>
        </button>
      </div>
    </a>
  ))}
</div>

{images.length === 0 && (
  <p class="py-24 text-center text-neutral-400">
    No wallpapers yet. Add images to <code class="text-xs">public/images/originals/</code> and run <code class="text-xs">npm run add-images</code>.
  </p>
)}

<p id="no-results" class="hidden py-24 text-center text-neutral-400">
  No wallpapers match your filter.
</p>
